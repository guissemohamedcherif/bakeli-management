{% extends 'base.html' %}
{% load static %}
{% block content %}


    <!-- Begin Page Content -->
    <div class="container-fluid">

        <!-- Page Heading -->
        <div class="d-sm-flex align-items-center justify-content-between mb-4 mt-4">
        <h1 class="h3 mb-0 text-gray-800">Mensualites de <strong>{{eleve.prenom}} {{eleve.nom}}</strong></h1>
        </div>          
 <!-- Divider -->
 <hr class="sidebar-divider">

    <div class="card o-hidden" style="text-align:center;"> 
    <div class="row">
        <div class="col-sm">
            <table id="mensTable" class="table table-striped">
                    <tr class="d-flex">
                        <th class="col" style="text-align:center" ><strong>MOIS</strong></th>
                        <th class="col" style="text-align:center" ><strong>MONTANT</strong></th>
                        <th class="col" style="text-align:center" ><strong>DATE PAIEMENT</strong></th>
                        <th class="col" style="text-align:center" colspan="2"><strong>ACTIONS</strong></th>
        
                      </tr>
                {% if mensualities %}
                {% for mens in mensualities %}
                <tbody>
                    <tr class="d-flex" id="mens-{{mens.id}}">
                      <td class="moisClass posteData col-md" name="mois" style="text-align:center">{{mens.mois}}</td>
                      <td class="mttClass posteData col-md" name="mtt" style="text-align:center">{{mens.montant}}</td>
                      <td class="dateClass posteData col-md" name="date" style="text-align:center">{{mens.date}}</td>
                      <td class="col-md" style="text-align:center">  
                          <div class="row">
                              <div class="col-sm">
                                <a class="btn btn-success" href=""><i class="fas fa-print"></i></a>            
                              </div>
                              <div class="col-sm">
                                <a class="btn btn-warning" href=""><i class="fas fa-archive"></i></a>            
                              </div>
                          </div>              
                    </td>  
                      
                  </tr>
                </tbody>  
                {% endfor %}              
                {% endif %}
              </table> 
        </div>
        <div class="col-sm">
            <form id="addMens" action="">
        <div class="modal-body">
    <div class="row">
    <div class="col-sm" style = "margin-left:10px;text-align:center;">
        <label>PRENOM</label>
        <input id="prenomId" readonly value="{{eleve.prenom}}" name="prenomName" type="text" class="form-control" aria-label="prenom" aria-describedby="basic-addon1">
    </div>
    <div class="col-sm" style = "margin-left:10px;text-align:center;">
        <label>NOM</label>
        <input id="nomId" readonly value="{{eleve.nom}}" name="nomName" type="text" class="form-control" aria-label="nom" aria-describedby="basic-addon1">
    </div> 
    </div>
    <div class="row" style="margin-top: 30px;">
        <div class="col-sm" style = "margin-left:10px;text-align:center;">
              <label style="margin:auto">CONTACT TUTEUR</label>
            <input id="telId" readonly value="{{eleve.tel}}" name="telName" type="text" class="form-control" aria-label="tel" aria-describedby="basic-addon1">
    </div>

    <div class="col-sm" style = "margin-right:10px;text-align:center;">
        <label style="margin:auto">MONTANT</label>
      <input id="mttId" readonly value="{{niveau.tarif}}" name="mttName" type="number" class="form-control" aria-label="mtt" aria-describedby="basic-addon1">
</div>
        </div>

        <div class="row" style="margin-top: 30px;">
            <div class="col-sm" style = "margin-left:10px;text-align:center;">
                <label>MOIS</label>
                <select class="form-control" id="moisId" name="moisName">   
                    <option value="">--- ---</option>
                    {% for mm in listMois %}
                    <option value="{{mm}}"> {{mm}}</option>
                    {% endfor %}
                </select>            </div>
            <div class="col-sm" style = "margin-left:10px;text-align:center;">
                <label>DATE PAIEMENT</label>
                <input id="dateId" name="dateName" type="date" class="form-control" aria-label="mtt" aria-describedby="basic-addon1">
            </div> 
            </div>

    <hr class="sidebar-divider">

    <div class="modal-footer" style="margin-top: 50px">
    <button id="btn_save" onClick="saveDatas({{eleve.id}})" name="btn" type="button" class="btn btn-primary" >Enregistrer</button>
    <button id="btn_close" onClick="resetAll()" class="btn btn-"type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
    </div>
    </form>
        </div>
    </div>
    </div>  
    </div>

    <script type="text/javascript">
        function resetAll(){
            $('#moisId').val("");
            $('#mttId').val("");
        }

        function saveDatas(id){
            var moisInput = $('#moisId').val();
            var mttInput = $('input[name="mttName"]').val().trim();
            var dateInput = $('input[name="dateName"]').val().trim();
            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
            var yyyy = today.getFullYear();
            
            today = yyyy + '/' + mm + '/' + dd;
            
            if (moisInput && dateInput) {
                // Create Ajax Call
                $.ajax({
                    url: '{% url "createMens" %}',
                    data: {
                        'mois': moisInput,
                        'mtt': mttInput,
                        'idT':id,
                        'date':dateInput,
                    },
                    
                    dataType: 'json',
                    success: function (data) {
                        if (data.mens){
                            appendToMensTable(data.mens) 
                        }
                    }
                });
              } else {
                alert("Remplir tous les champs.");
            }
            $('form#addMens').trigger("reset");
        }

        function appendToMensTable(mens) {
            $("#mensTable > tbody:last-child").append(`
                  <tr class="d-flex" id="mens-${mens.id}">
                      <td class="moisClass posteData col-md" name="mois" style="text-align:center">${mens.mois}</td>
                      '<td class="mttClass posteData col-md" name="mtt" style="text-align:center">${mens.montant}</td>
                      '<td class="dateClass posteData col-md" name="date" style="text-align:center">${mens.date}</td>
                      '<td class="col-md" style="text-align:center" >                
                        <a class="btn btn-warning" href=""><i class="fas fa-archive"></i></a>            
                    </td> 
                  </tr>
              `);
          }
          
    </script>
    {% endblock content %}